<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>FerBot ¬∑ Panel</title>
<style>
/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
   FerBot ¬∑ Panel (solo UI). Estructura intacta, dise√±o actualizado.
   TODO(üß†): when AGI arrives, replace this CSS with a single prompt.
   ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
:root{
  --platzi:#97C93E;          /* Platzi Green */
  --platzi-2:#7FB02F;
  --ink:#E6F2FF;
  --mut:#94a3b8;
  --card:#0f162a80;          /* glass */
  --stroke:rgba(255,255,255,.12);
  --field:#0f1524;
}

*{box-sizing:border-box}
html,body{
  height:100%;
  margin:0;
  color:var(--ink);
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial;
  background:
    radial-gradient(1200px 600px at 10% -20%, rgba(151,201,62,.18), transparent 60%),
    radial-gradient(1000px 500px at 100% 0%, rgba(151,201,62,.12), transparent 55%),
    linear-gradient(180deg, #0b0f19 0%, #0b0f19 35%, #0d1122 100%);
  overflow-y:auto;
}

/* sutil grid ‚Äútech‚Äù */
body::before{
  content:"";
  position:fixed; inset:0;
  background:
    linear-gradient(to right, rgba(255,255,255,.03) 1px, transparent 1px) 0 0/24px 24px,
    linear-gradient(to bottom, rgba(255,255,255,.03) 1px, transparent 1px) 0 0/24px 24px;
  pointer-events:none;
  mask:linear-gradient(#000, transparent 85%);
}

/* contenedor */
.wrap{
  max-width:980px;
  margin:28px auto 64px;
  padding:0 16px;
}

/* header */
.header{
  display:flex; align-items:center; justify-content:space-between;
  margin:0 0 12px;
}
h1{
  margin:0;
  font-size:22px;
  letter-spacing:.2px;
  display:flex; align-items:center; gap:10px;
}
h1::after{
  content:"";
  display:block; width:120px; height:2px; border-radius:2px;
  background:linear-gradient(90deg, rgba(151,201,62,.0), rgba(151,201,62,.65), rgba(151,201,62,.0));
}

/* tarjeta ‚Äúglass‚Äù */
.card{
  background:var(--card);
  border:1px solid var(--stroke);
  box-shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.04);
  backdrop-filter: blur(8px);
  border-radius:18px;
  padding:18px;
  position:relative;
}

/* acento degradado (semi transparente) */
.card::before{
  content:"";
  position:absolute; inset:-1px;
  border-radius:18px;
  padding:1px;
  background:linear-gradient(135deg, rgba(151,201,62,.6), rgba(151,201,62,0) 45%, rgba(151,201,62,.35));
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor; mask-composite:exclude;
  pointer-events:none;
}

/* layout simple */
.row{display:flex; gap:12px; align-items:flex-start}
.row>div{flex:1}

/* labels + fields */
label{display:block; font-size:12px; color:var(--mut); margin:8px 0 6px}
input,select,textarea{
  width:100%;
  background:var(--field);
  border:1px solid var(--stroke);
  color:#D7E7FF;
  border-radius:12px;
  padding:12px 12px;
  outline:none;
  transition: border-color .15s, box-shadow .15s, background .2s;
}
textarea{min-height:96px; resize:vertical}
input:focus,select:focus,textarea:focus{
  border-color: rgba(151,201,62,.65);
  box-shadow: 0 0 0 3px rgba(151,201,62,.15);
}

/* sentiment badge */
.badge{
  display:inline-flex; align-items:center; gap:6px;
  font-size:12px; padding:6px 10px;
  border-radius:999px; border:1px solid var(--stroke); background:rgba(16,23,39,.85);
  height:32px; margin:0 0 6px 6px;
}
.badge .dot{width:8px;height:8px;border-radius:50%; background:#64748b}
.badge.pos .dot{background:#22c55e}
.badge.neu .dot{background:#f59e0b}
.badge.neg .dot{background:#ef4444}

/* timer */
.signal{
  display:inline-flex; align-items:center; gap:8px;
  background:rgba(16,23,39,.8);
  border:1px solid var(--stroke);
  padding:6px 12px; border-radius:999px; font-variant-numeric:tabular-nums;
}
.bullet{width:10px;height:10px;border-radius:999px;background:#ef4444; box-shadow:0 0 12px #ef4444}
.bullet.amber{background:#f59e0b; box-shadow:0 0 12px #f59e0b}
.bullet.green{background:#22c55e; box-shadow:0 0 12px #22c55e}

/* botones */
.btns{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
.btn{
  padding:12px 14px; border-radius:12px; border:0; cursor:pointer; font-weight:800;
  letter-spacing:.2px; transition: transform .05s ease, filter .2s;
}
.btn:active{ transform: translateY(1px) }
.primary{
  color:#062d1f;
  background:linear-gradient(180deg, var(--platzi) 0%, var(--platzi-2) 100%);
  box-shadow: 0 6px 16px rgba(151,201,62,.28);
}
.ghost{ background:#1b2333; color:#cfe3ff; border:1px solid var(--stroke) }
.good{ background:#19c37d; color:#062d1f; display:none }
.reg { background:#fbbf24; color:#332200; display:none }
.bad { background:#ef4444; color:#fff; display:none }

/* footer huevo de pascua (discreto) */
.footer{
  margin:18px 0 0; text-align:center; color:var(--mut); font-size:12px;
  opacity:.7;
}
.footer code{color:#8BD626}
.footer .hint{opacity:.6}
/* 01000110 01100101 01110010 01000010 01101111 01110100 ‚Äî si lees esto, te ganaste un ‚òï */
</style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <h1>FerBot ü§ñ ¬∑ Panel</h1>
      <span class="signal"><span id="b" class="bullet"></span><span id="t">0.0s</span></span>
    </div>

    <div class="card">
      <div class="row">
        <div>
          <label>Nombre del cliente</label>
          <input id="name" placeholder="Ej. Laura"/>
        </div>
        <div>
          <label>Etapa</label>
          <select id="stage">
            <option value="integracion">Integraci√≥n</option>
            <option value="sondeo">Sondeo</option>
            <option value="rebatir" selected>Rebatir</option>
            <option value="pre_cierre">Pre-cierre</option>
            <option value="cierre">Cierre</option>
          </select>
        </div>
      </div>

      <label>Contexto (opcional)</label>
      <input id="ctx" placeholder="Notas breves para el bot..."/>

      <div class="row" style="align-items:flex-end;margin-top:10px">
        <div style="flex:1">
          <label>Texto del cliente / Objeci√≥n</label>
          <textarea id="in" placeholder="Selecciona texto del chat o escribe aqu√≠..."></textarea>
        </div>
        <div class="badge neu" id="sent">
          <span class="dot"></span><span id="sTxt">Neutral</span>
        </div>
      </div>

      <label>Explicaci√≥n (POR QU√â + SIGUIENTE PASO)</label>
      <textarea id="guide" placeholder="Aqu√≠ ver√°s POR QU√â y el SIGUIENTE PASO..."></textarea>

      <label>Respuesta (lista para pegar)</label>
      <textarea id="out" placeholder="Mensaje breve (‚â§ 2 frases)."></textarea>

      <div class="btns">
        <button id="gen" class="btn primary">Generar</button>
        <button id="clr" class="btn ghost">Clear</button>
        <button id="g" class="btn good">üëç Buena</button>
        <button id="r" class="btn reg">üòê Regular</button>
        <button id="b1" class="btn bad">üëé Mala</button>
      </div>

      <div class="footer">
        <span class="hint">// api: <code id="api-hint">loading‚Ä¶</code></span>
      </div>
    </div>
  </div>

<script>
/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî JS original (llamadas intactas) ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
const BASE = (localStorage.getItem('ferbot_api_base') || '') || (location.origin);
document.getElementById('api-hint').textContent = BASE.replace(/^https?:\/\//,'');

const nameEl = document.getElementById('name');
const stageEl= document.getElementById('stage');
const ctxEl  = document.getElementById('ctx');
const inEl   = document.getElementById('in');
const outEl  = document.getElementById('out');
const guideEl= document.getElementById('guide');
const btnGen = document.getElementById('gen');
const btnClr = document.getElementById('clr');
const btnGood= document.getElementById('g');
const btnReg = document.getElementById('r');
const btnBad = document.getElementById('b1');
const dot    = document.getElementById('b');
const timer  = document.getElementById('t');
const badge  = document.getElementById('sent');
const bTxt   = document.getElementById('sTxt');

let clock=null, t0=0, lastReply=null;

function start() {
  stop(); t0 = performance.now();
  clock = setInterval(()=>{
    const dt = (performance.now()-t0)/1000;
    timer.textContent = dt.toFixed(1)+'s';
    dot.className='bullet'+(dt<2?'':' '+(dt<4?'amber':'green'));
  }, 100);
}
function stop(){ if(clock) clearInterval(clock); clock=null; }
function toggleRatings(show){ [btnGood,btnReg,btnBad].forEach(x=>x.style.display=show?'inline-block':'none'); }
function sent(text){
  const s=(text||'').toLowerCase();
  let cls='neu', t='Neutral';
  if (/(no puedo|caro|no sirve|dif√≠cil|no tengo tiempo)/i.test(s)) {cls='neg';t='Negativo'}
  else if (/(gracias|perfecto|me interesa|genial|bien)/i.test(s)) {cls='pos';t='Positivo'}
  badge.classList.remove('pos','neu','neg'); badge.classList.add(cls); bTxt.textContent=t;
}
inEl.addEventListener('input',()=>sent(inEl.value));
document.addEventListener('mouseup',()=>setTimeout(()=>{
  const sel = window.getSelection()?.toString()?.trim();
  if(sel){ inEl.value=sel; sent(sel); }
},30));

btnGen.onclick = async ()=>{
  const q=(inEl.value||'').trim();
  if(!q){ alert('Escribe o selecciona un texto primero.'); return; }
  guideEl.value=''; outEl.value=''; toggleRatings(false); start();
  try{
    const r = await fetch(BASE+'/assist_trainer',{
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ question:q, customerName:(nameEl.value||'Cliente'), stage:stageEl.value, context:ctxEl.value })
    });
    stop(); dot.className='bullet green';
    if(!r.ok){ alert('No se pudo generar.'); return; }
    const j = await r.json();
    const reply = j?.result?.reply || j?.text || '';
    const why   = j?.result?.why || '';
    const next  = j?.result?.next || '';
    outEl.value = reply;
    guideEl.value = `POR QU√â: ${why}\nSIGUIENTE PASO: ${next}`;
    lastReply = reply; toggleRatings(true);
  }catch(e){ stop(); alert('No se pudo generar. Revisa que el servidor est√© arriba.'); }
};
btnClr.onclick = ()=>{
  inEl.value=''; outEl.value=''; guideEl.value='';
  toggleRatings(false); stop(); dot.className='bullet'; timer.textContent='0.0s'; sent('');
};
btnGood.onclick=()=>rate('good');
btnReg.onclick=()=>rate('regular');
btnBad.onclick=()=>rate('bad');

async function rate(kind){
  if(!lastReply) return; toggleRatings(false);
  try{
    await fetch(BASE+'/trackRate',{
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ rating:kind, text:lastReply, stage:stageEl.value, intent:guessIntent(inEl.value) })
    });
  }catch(_){}
}
function guessIntent(q=''){
  q=q.toLowerCase();
  if(/tiempo|agenda|ocupad/.test(q)) return 'tiempo';
  if(/precio|caro|costo|descuento/.test(q)) return 'precio';
  if(/cert/.test(q)) return 'cert';
  if(/coursera|udemy|alura|competenc/.test(q)) return 'competencia';
  if(/platzi|pitch/.test(q)) return 'pitch';
  return '_panel';
}
</script>
</body>
</html>
